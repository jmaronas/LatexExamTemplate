\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{examen}[2025/10/15 Plantilla simple para exámenes universitarios creada por Juan Maroñas y ChatGPT]

% ===== Paquetes básicos =====
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[spanish]{babel}
\usepackage{geometry}
\usepackage{setspace}
\usepackage{fancyhdr}
\usepackage{titlesec}
\usepackage{parskip}
\usepackage{helvet}
\usepackage{xcolor}
\usepackage{tcolorbox} 
\tcbuselibrary{breakable} 
\usepackage{tikz}
\usepackage{float}
\usetikzlibrary{positioning}
\usepackage{xparse}

% ===== Paquetes matemáticos =====
\usepackage{amsmath,amssymb,amsthm,mathtools,bm,physics,siunitx,xfrac,cancel,nicefrac}

% Márgenes
\geometry{a4paper, margin=2.5cm}

% Fuente principal y de títulos
\renewcommand{\familydefault}{\rmdefault}  
\newcommand{\titlefont}{\sffamily\bfseries} 

% Espaciado
\setstretch{1.2}

% ===== Opciones de paquete =====
\newif\ifshowsolutions
\newif\ifshowanswerbox
\showanswerboxtrue
\DeclareOption{solution}{
\showsolutionstrue
\showanswerboxfalse
}
\DeclareOption*{\relax}
\ProcessOptions\relax

% ===== Comandos configurables =======
\newcommand{\examtitle}{}
\newcommand{\examtype}{}
\newcommand{\degree}{}
\newcommand{\examdate}{}
\newcommand{\examduration}{}
\newcommand{\examinstructions}{} % <-- aquí almacenamos las instrucciones
\newcommand{\nota}[1]{(#1/\_\_\_\_)} % <-- aquí almacenamos las instrucciones


\newcommand{\setexamtitle}[1]{\renewcommand{\examtitle}{#1}}
\newcommand{\setexamtype}[1]{\renewcommand{\examtype}{#1}}
\newcommand{\setdegree}[1]{\renewcommand{\degree}{#1}}
\newcommand{\setexamdate}[1]{\renewcommand{\examdate}{#1}}
\newcommand{\setexamduration}[1]{\renewcommand{\examduration}{#1}}
\newcommand{\setexaminstructions}[1]{\renewcommand{\examinstructions}{#1}} % <-- setter instrucciones

% ===== Pie de página por página =======
\pagestyle{fancy}
\fancyhf{} % limpiar cabecera y pie

% Pie con línea horizontal y ancho limitado
\fancyfoot[L]{%
  \parbox[t]{0.48\textwidth}{\examtitle \\ \examtype}%
}
\fancyfoot[R]{%
  \parbox[t]{0.48\textwidth}{\raggedleft \degree}%
}
\fancyfoot[C]{\thepage} % opcional: número de página centrado

\renewcommand{\footrulewidth}{0.4pt} % línea horizontal en el pie
\renewcommand{\headrulewidth}{0pt}   % eliminar línea de cabecera


% ===== Formato de títulos =======
\titleformat{\section}{\bfseries\LARGE}{Problema \thesection.}{0.5em}{}
\renewcommand{\thesubsection}{\arabic{subsection}}
\titleformat{\subsection}
  {\normalsize\bfseries}                  
  {Apartado \thesubsection.}                   
  {0.5em}
  {}
\titleformat{\subsubsection}
  {\small\bfseries}                  
  {\thesubsubsection.}                   
  {0.5em}
  {}


% % ===== Comando para respuesta =======
\NewDocumentCommand{\answerbox}{O{\textbf{Respuesta:}} m o}{%
  \ifshowanswerbox
    \begin{tcolorbox}[
        colframe=black,
        colback=white,
        boxrule=0.4pt,
        width=\textwidth,
        height=#2cm,
        top=2mm, bottom=2mm, left=2mm, right=2mm,
        breakable
    ]
    #1 \\[3pt] % título (por defecto "Respuesta:")
    \IfValueT{#3}{#3} % contenido solo si se pasa
    \end{tcolorbox}
  \fi
}



% ===== Comando \solution con recuadro =======
\newtcolorbox{solutionbox}{
  colframe=purple!80!black,
  colback=purple!10,
  coltitle=purple!80!black,
  title=Solución,
  boxrule=0.8pt,
  arc=4pt,
  left=3mm,
  right=3mm,
  top=2mm,
  bottom=2mm
}

\newcommand{\solution}[1]{%
  \ifshowsolutions  
    \begin{solutionbox}
    \textbf{Solucion: }
      
      #1
    \end{solutionbox}
  \fi
}

% ===== Portada del examen =======
\newcommand{\makeexamheader}{
\thispagestyle{empty} % <-- elimina cabecera y pie en la portada
  \begin{center}
    {\Huge \examtitle}\\[0.25cm]
    {\large  \examtype}\\[0.25cm]
    {\Large \degree}\\[0.25cm]
    \textbf{Fecha:} \examdate \hspace{1cm}
    \textbf{Duración:} \examduration
  \end{center}

  \vspace{1cm}

  \noindent\textbf{Nombre y apellidos:} \rule{12cm}{0.4pt}\\[0.4cm]
  \textbf{DNI:} \rule{6cm}{0.4pt}

  \vspace{1cm}
  \noindent\rule{\textwidth}{0.4pt}
  \vspace{0.3cm}

  % Mostrar instrucciones configuradas
  {\titlefont Normas de Examen:}

  \examinstructions

  \vspace{0.5cm}
  \noindent\rule{\textwidth}{0.4pt}

  \clearpage
}
