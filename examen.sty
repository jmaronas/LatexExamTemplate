\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{examen}[2025/10/15 Plantilla simple para exámenes universitarios creada por Juan Maroñas y ChatGPT]

% ===== Paquetes básicos =====
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[spanish]{babel}
\usepackage{geometry}
\usepackage{setspace}
\usepackage{fancyhdr}
\usepackage{titlesec}
\usepackage{parskip}
\usepackage{helvet}
\usepackage{xcolor}
\usepackage{tcolorbox} % Para recuadros
\usepackage{tikz}
\usetikzlibrary{positioning}

% ===== Paquetes matemáticos =====
\usepackage{amsmath,amssymb,amsthm,mathtools,bm,physics,siunitx,xfrac,cancel,nicefrac}

% Márgenes
\geometry{a4paper, margin=2.5cm}

% Fuente principal y de títulos
\renewcommand{\familydefault}{\rmdefault}  
\newcommand{\titlefont}{\sffamily\bfseries} 

% Espaciado
\setstretch{1.2}

% ===== Opciones de paquete =====
\newif\ifshowsolutions
\DeclareOption{solution}{\showsolutionstrue}
\DeclareOption*{\relax}
\ProcessOptions\relax

% ===== Comandos configurables =======
\newcommand{\examtitle}{}
\newcommand{\examtype}{}
\newcommand{\degree}{}
\newcommand{\examdate}{}
\newcommand{\examduration}{}
\newcommand{\examinstructions}{} % <-- aquí almacenamos las instrucciones

\newcommand{\setexamtitle}[1]{\renewcommand{\examtitle}{#1}}
\newcommand{\setexamtype}[1]{\renewcommand{\examtype}{#1}}
\newcommand{\setdegree}[1]{\renewcommand{\degree}{#1}}
\newcommand{\setexamdate}[1]{\renewcommand{\examdate}{#1}}
\newcommand{\setexamduration}[1]{\renewcommand{\examduration}{#1}}
\newcommand{\setexaminstructions}[1]{\renewcommand{\examinstructions}{#1}} % <-- setter instrucciones

% ===== Cabecera =======
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\fancyfoot[C]{\thepage}

% ===== Formato de títulos =======
\titleformat{\section}{\bfseries\LARGE}{Problema \thesection.}{0.5em}{}
\renewcommand{\thesubsection}{\arabic{subsection}}
\titleformat{\subsection}
  {\normalsize\bfseries}                  % Fuente sans-serif y tamaño "large"
  {Apartado \thesubsection.}                   % Numeración simple: 1., 2., 3.
  {0.5em}
  {}
\titleformat{\subsubsection}
  {\small\bfseries}                  % Fuente sans-serif y tamaño "large"
  {\thesubsubsection.}                   % Numeración simple: 1., 2., 3.
  {0.5em}
  {}



% ===== Comando \solution con recuadro =======
\newtcolorbox{solutionbox}{
  colframe=purple!80!black,
  colback=purple!10,
  coltitle=purple!80!black,
  title=Solución,
  boxrule=0.8pt,
  arc=4pt,
  left=3mm,
  right=3mm,
  top=2mm,
  bottom=2mm
}

\newcommand{\solution}[1]{%
  \ifshowsolutions  
    \begin{solutionbox}
    \textbf{Solucion: }
      
      #1
    \end{solutionbox}
  \fi
}

% ===== Portada del examen =======
\newcommand{\makeexamheader}{
  \begin{center}
    {\Huge \examtitle}\\[0.25cm]
    {\large  \examtype}\\[0.25cm]
    {\Large \degree}\\[0.25cm]
    \textbf{Fecha:} \examdate \hspace{1cm}
    \textbf{Duración:} \examduration
  \end{center}

  \vspace{1cm}

  \noindent\textbf{Nombre y apellidos:} \rule{12cm}{0.4pt}\\[0.4cm]
  \textbf{DNI:} \rule{6cm}{0.4pt}

  \vspace{1cm}
  \noindent\rule{\textwidth}{0.4pt}
  \vspace{0.3cm}

  % Mostrar instrucciones configuradas
  {\titlefont Normas de Examen:}

  \examinstructions

  \vspace{0.5cm}
  \noindent\rule{\textwidth}{0.4pt}

  \clearpage
}
